[
    {
        "UpdateStageName": "Run MongoDB Server",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd mongodb && mongosh/bin/mongosh --quiet --host \\\"{{$FullBaseDir}}run/mongod.sock\\\" && exit 0 || { mongodb/bin/mongod {{CustomServerOptions}} --auth --config \\\"{{$FullBaseDir}}mongod.conf\\\" --dbpath \\\"{{$FullBaseDir}}data\\\" --port {{$ServerPort}} --bind_ip localhost,{{$ApplicationIPBinding}},\\\"{{$FullBaseDir}}run/mongod.sock\\\" --unixSocketPrefix \\\"{{$FullBaseDir}}run\\\" --logpath \\\"{{$FullBaseDir}}log/mongodb/mongod.log\\\" --logappend --fork; }\"",
        "RunInBackground": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Wait For Server Start",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd mongodb && timeout=60; while ((timeout--)); do mongosh/bin/mongosh --quiet --host \\\"{{$FullBaseDir}}run/mongod.sock\\\" && break || sleep 1; done; ((timeout<0)) && { echo \\\"MongoDB server failed to start. Aborting\\\"; exit 1; }\"",
        "SkipOnFailure": false
    }
]