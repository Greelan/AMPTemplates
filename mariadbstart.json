[
    {
        "UpdateStageName": "Run MariaDB Server",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd mariadb/mariadb && bin/mariadb-admin --socket=../run/mariadbd/mariadbd.sock ping >/dev/null 2>&1 && exit 0 || bin/mariadbd --defaults-file=../.my.cnf --port={{$ServerPort}} &\"",
        "RunInBackground": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Run MariaDB Server",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"Set-Location -Path 'mariadb/mariadb'; if (& bin/mariadb-admin.exe --port={{$ServerPort}} ping > $null 2>&1) { exit 0 } else { & bin/mariadbd.exe --defaults-file=../.my.cnf --port={{$ServerPort}} }\"",
        "RunInBackground": true,
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Upgrade MariaDB",
        "UpdateSourcePlatform": "Linux",
        "UpdateSource": "Executable",
        "UpdateSourceData": "/bin/bash",
        "UpdateSourceArgs": "-c \"cd mariadb/mariadb && while true; do bin/mariadb-admin --socket=../run/mariadbd/mariadbd.sock ping >/dev/null 2>&1 && break || sleep 1; done; bin/mariadb-upgrade --port={{$ServerPort}} --socket=../run/mariadbd/mariadbd.sock --user=amp\"",
        "SkipOnFailure": false
    },
    {
        "UpdateStageName": "Set Up and Upgrade MariaDB",
        "UpdateSourcePlatform": "Windows",
        "UpdateSource": "Executable",
        "UpdateSourceData": "powershell.exe",
        "UpdateSourceArgs": "-NoProfile -Command \"Set-Location -Path 'mariadb/mariadb'; while ($true) { & bin/mariadb-admin.exe --port={{$ServerPort}} ping *> $null 2>&1; if ($LASTEXITCODE -eq 0) { break }; Start-Sleep -Seconds 1 }; & bin/mariadb.exe -u root --port={{$ServerPort}} -e \\\"CREATE USER IF NOT EXISTS 'amp'@'localhost' IDENTIFIED BY ''; GRANT ALL ON *.* TO 'amp'@'localhost' WITH GRANT OPTION; FLUSH PRIVILEGES;\\\"; & bin/mariadb-upgrade.exe --port={{$ServerPort}} --user=amp\"",
        "SkipOnFailure": false
    }
]